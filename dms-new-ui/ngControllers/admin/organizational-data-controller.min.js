"use strict";define(["angularAMD","organizationalDataService","uiSelect","uiSelectWrap"],function(a){a.controller("OrganizationalDataController",["organizationalDataService","notificationService","configService","$scope","$rootScope","$q",function(a,n,t,e,i,o){var r=this,d=t.getUIResources("OrganizationData");i.kpiOwners=[],i.title="List Maintenance",r.selectedType=0,r.dataLoaded=!1,r.organizationData=[],r.organization=[],r.isActiveOptions=[{id:1,name:"Active"},{id:2,name:"Inactive"}],r.addNewRow=function(){r.gridOptions.data.unshift({id:"",name:"",isActive:""})},r.OrganizationalDataColumnDefs=[{name:"id",displayName:"Id",field:"id",enableCellEdit:!1,visible:!1},{name:"name",displayName:"Name",field:"name",enableCellEdit:!0,validators:{required:!0},enableHiding:!1,width:"50%",enableSorting:!0,filter:{placeholder:"Search"}},{name:"isActive",displayName:"Status",enableCellEdit:!0,width:"50%",cellFilter:"griddropdown:editDropdownOptionsArray:editDropdownIdLabel:editDropdownValueLabel:row.entity.isActive.name",editableCellTemplate:"ngViews/metrics/templates/uiSelect.html",editDropdownValueLabel:"name",editDropdownIdLabel:"id",enableSorting:!1,enableColumnMenu:!1,enableFiltering:!1}],r.gridOptions={rowHeight:43,data:r.organizationData,columnDefs:r.OrganizationalDataColumnDefs,enableRowSelection:!0,enableRowHeaderSelection:!1,enableFiltering:!0},r.onListChange=function(a){switch(r.selectedType=a,a){case 0:c();break;case 1:l();break;case 2:f();break;case 3:g();break;case 4:u();break;case 5:p()}};var s=function(){r.gridOptions.columnDefs[2].editDropdownOptionsArray=r.isActiveOptions},c=function(){r.dataLoaded=!1,a.getBusinessSegments().then(function(a){r.organizationData=a,angular.forEach(r.organizationData,function(a){a.isActive={id:a.isActive===!0?1:2,name:a.isActive===!0?"Active":"Inactive"}}),r.gridOptions.data=r.organizationData,r.dataLoaded=!0},function(a){n.notify(a.errors.join("<br>"),{autoclose:!1,type:"danger"}),r.dataLoaded=!0})},u=function(){r.dataLoaded=!1,a.getDepartments().then(function(a){r.organizationData=a,angular.forEach(r.organizationData,function(a){a.isActive={id:a.isActive===!0?1:2,name:a.isActive===!0?"Active":"Inactive"}}),r.gridOptions.data=r.organizationData,r.dataLoaded=!0},function(a){n.notify(a.errors.join("<br>"),{autoclose:!1,type:"danger"}),r.dataLoaded=!0})},l=function(){r.dataLoaded=!1,a.getDivisions().then(function(a){r.organizationData=a,angular.forEach(r.organizationData,function(a){a.isActive={id:a.isActive===!0?1:2,name:a.isActive===!0?"Active":"Inactive"}}),r.gridOptions.data=r.organizationData,r.dataLoaded=!0},function(a){n.notify(a.errors.join("<br>"),{autoclose:!1,type:"danger"}),r.dataLoaded=!0})},g=function(){r.dataLoaded=!1,a.getProductLines().then(function(a){r.organizationData=a,angular.forEach(r.organizationData,function(a){a.isActive={id:a.isActive===!0?1:2,name:a.isActive===!0?"Active":"Inactive"}}),r.gridOptions.data=r.organizationData,r.dataLoaded=!0},function(a){n.notify(a.errors.join("<br>"),{autoclose:!1,type:"danger"}),r.dataLoaded=!0})},f=function(){r.dataLoaded=!1,a.getFacilities().then(function(a){r.organizationData=a,angular.forEach(r.organizationData,function(a){a.isActive={id:a.isActive===!0?1:2,name:a.isActive===!0?"Active":"Inactive"}}),r.gridOptions.data=r.organizationData,r.dataLoaded=!0},function(a){n.notify(a.errors.join("<br>"),{autoclose:!1,type:"danger"}),r.dataLoaded=!0})},p=function(){r.dataLoaded=!1,a.getProcesses().then(function(a){r.organizationData=a,angular.forEach(r.organizationData,function(a){a.isActive={id:a.isActive===!0?1:2,name:a.isActive===!0?"Active":"Inactive"}}),r.gridOptions.data=r.organizationData,r.dataLoaded=!0},function(a){n.notify(a.errors.join("<br>"),{autoclose:!1,type:"danger"}),r.dataLoaded=!0})},y=function(){a.getOrganizationalData().then(function(a){r.organizationDataList=a},function(a){n.notify(a.errors.join("<br>"),{autoclose:!1,type:"danger"})})};r.refreshData=function(){switch(r.gridOptions.data.length=0,r.dataLoaded=!1,r.selectedType){case 0:c();break;case 1:l();break;case 2:f();break;case 3:g();break;case 4:u();break;case 5:p()}},r.gridOptions.onRegisterApi=function(a){r.gridApi=a,a.rowEdit.on.saveRow(e,r.saveRow)},r.setOrganizationData=function(a){r.organization.push({id:a.id,name:a.name,isActive:2!==parseInt(a.isActive.id)})};var v=function(a){r.addOperation=""===a};r.saveRow=function(t){r.dataLoaded=!1,r.organizationName=h(r.selectedType),r.setOrganizationData(t),v(r.organization[0].id);var e=o.defer();switch(r.gridApi.rowEdit.setSavePromise(t,e.promise),r.selectedType){case 0:a.addOrUpdateBusinessSegments(r.organization).then(function(a){e.resolve(),r.addOperation?n.notify(r.organizationName+" "+d.AddedSuccessfully,{type:"success"}).then(function(){r.gridOptions.data.length=0,c()},function(a){}):n.notify(r.organizationName+" "+d.UpdatedSuccessfully,{type:"success"}).then(function(){r.gridOptions.data.length=0,c()},function(a){})},function(a){e.resolve(),n.notify(a.errors.join("<br/>"),{autoClose:!1,type:"danger"})}),r.organization=[];break;case 1:a.addOrUpdateDivisions(r.organization).then(function(a){e.resolve(),r.addOperation?n.notify(r.organizationName+" "+d.AddedSuccessfully,{type:"success"}).then(function(){r.gridOptions.data.length=0,l()},function(a){}):n.notify(r.organizationName+" "+d.UpdatedSuccessfully,{type:"success"}).then(function(){r.gridOptions.data.length=0,l()},function(a){})},function(a){e.resolve(),n.notify(a.errors.join("<br/>"),{autoClose:!1,type:"danger"})}),r.organization=[];break;case 2:a.addOrUpdateFacilities(r.organization).then(function(a){e.resolve(),r.addOperation?n.notify(r.organizationName+" "+d.AddedSuccessfully,{type:"success"}).then(function(){r.gridOptions.data.length=0,f()},function(a){}):n.notify(r.organizationName+" "+d.UpdatedSuccessfully,{type:"success"}).then(function(){r.gridOptions.data.length=0,f()},function(a){})},function(a){e.resolve(),n.notify(a.errors.join("<br/>"),{autoClose:!1,type:"danger"})}),r.organization=[];break;case 3:a.addOrUpdateProductLines(r.organization).then(function(a){e.resolve(),r.addOperation?n.notify(r.organizationName+" "+d.AddedSuccessfully,{type:"success"}).then(function(){r.gridOptions.data.length=0,g()},function(a){}):n.notify(r.organizationName+" "+d.UpdatedSuccessfully,{type:"success"}).then(function(){r.gridOptions.data.length=0,g()},function(a){})},function(a){e.resolve(),n.notify(a.errors.join("<br/>"),{autoClose:!1,type:"danger"})}),r.organization=[];break;case 4:a.addOrUpdateDepartments(r.organization).then(function(a){e.resolve(),r.addOperation?n.notify(r.organizationName+" "+d.AddedSuccessfully,{type:"success"}).then(function(){r.gridOptions.data.length=0,u()},function(a){}):n.notify(r.organizationName+" "+d.UpdatedSuccessfully,{type:"success"}).then(function(){r.gridOptions.data.length=0,u()},function(a){})},function(a){e.resolve(),n.notify(a.errors.join("<br/>"),{autoClose:!1,type:"danger"})}),r.organization=[];break;case 5:a.addOrUpdateProcess(r.organization).then(function(a){e.resolve(),r.addOperation?n.notify(r.organizationName+" "+d.AddedSuccessfully,{type:"success"}).then(function(){r.gridOptions.data.length=0,p()},function(a){}):n.notify(r.organizationName+" "+d.UpdatedSuccessfully,{type:"success"}).then(function(){r.gridOptions.data.length=0,p()},function(a){})},function(a){e.resolve(),n.notify(a.errors.join("<br/>"),{autoClose:!1,type:"danger"})}),r.organization=[]}};var h=function(a){var n=$.grep(r.organizationDataList,function(n){if(n.id===a)return n});return n.length?n[0].name:(r.selectedType="","")};(function(){s(),y(),c()})()}])});