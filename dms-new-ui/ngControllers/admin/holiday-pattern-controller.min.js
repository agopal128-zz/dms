"use strict";define(["angularAMD","holidayPatternService","uiSelect","uiSelectWrap"],function(e){e.controller("HolidayPatternController",["holidayPatternService","notificationService","configService","$scope","$rootScope","$q",function(e,t,i,n,a,o){var d=this,r=i.getUIResources("Holiday");d.holidayPatterns=[],d.patternsLoaded=!1,a.kpiOwners=[],a.title="Holiday Schedule",d.isActiveOptions=[{id:1,name:"Active"},{id:2,name:"Inactive"}],d.addNewRow=function(){d.gridOptions.data.unshift({id:"",name:"",isActive:""})},d.refreshData=function(){d.gridOptions.data.length=0,d.patternsLoaded=!1,s()},d.HolidayPatternColumnDefs=[{name:"id",displayName:"Id",field:"id",enableCellEdit:!1,visible:!1},{name:"name",displayName:"Holiday Schedule",field:"name",enableCellEdit:!0,validators:{required:!0},cellTemplate:'<div><a ng-href ="Admin/HolidaySchedule/{{row.entity.id}}">{{row.entity.name}}</a></div>',enableHiding:!1,width:"50%",enableSorting:!0,filter:{placeholder:"Search"}},{name:"isActive",displayName:"Status",enableCellEdit:!0,width:"30%",cellFilter:"griddropdown:editDropdownOptionsArray:editDropdownIdLabel:editDropdownValueLabel:row.entity.isActive.name",editableCellTemplate:"ngViews/metrics/templates/uiSelect.html",editDropdownValueLabel:"name",editDropdownIdLabel:"id",enableSorting:!1,enableColumnMenu:!1,enableFiltering:!1},{name:"copy",displayName:"",enableCellEdit:!1,width:"20%",cellTemplate:'<button class="btn button-add" ng-show="row.entity.id || row.entity.id === 0" ng-click="grid.appScope.copyPattern(row)">Copy</button>',enableHiding:!1,enableSorting:!1,enableColumnMenu:!1,enableFiltering:!1}],d.validationRules={Name:[new ValidationRule(validationType.required,(!0),r.RequiredHolidayPatternName)]},d.gridOptions={rowHeight:43,data:d.metricData,columnDefs:d.HolidayPatternColumnDefs,enableRowSelection:!0,enableRowHeaderSelection:!1,enableFiltering:!0},d.setHolidayPatternData=function(e){d.holidayPattern={id:e.id,name:e.name,isActive:2!==e.isActive.id}},d.checkAddorUpdate=function(e){d.addOperation=""===e},n.copyPattern=function(i){e.copyHolidayPattern(i.entity.id).then(function(e){t.notify(r.CopiedSuccessfully.format(i.entity.name),{type:"success"}).then(function(){d.refreshData()})},function(e){t.notify(e.errors.join("<br>"),{autoclose:!1,type:"danger"})})},d.saveRow=function(i){d.patternLoaded=!1,d.setHolidayPatternData(i),d.checkAddorUpdate(d.holidayPattern.id);var n=o.defer();d.gridApi.rowEdit.setSavePromise(i,n.promise),e.addOrUpdateHolidayPattern(d.holidayPattern).then(function(e){n.resolve(),d.addOperation?t.notify(r.AddedSuccessfully,{type:"success"}).then(function(){d.gridOptions.data.length=0,s()}):t.notify(r.UpdatedSuccessfully,{type:"success"}).then(function(){d.gridOptions.data.length=0,s()})},function(e){n.resolve(),t.notify(e.errors.join("<br/>"),{autoClose:!0,type:"danger"}).then(function(){d.gridOptions.data.length=0,s()})}),d.holidayPattern={}},d.gridOptions.onRegisterApi=function(e){d.gridApi=e,e.rowEdit.on.saveRow(n,d.saveRow)};var l=function(){d.gridOptions.columnDefs[2].editDropdownOptionsArray=d.isActiveOptions},s=function(){e.getAllHolidayPatterns().then(function(e){d.holidayPatterns=e.reverse(),d.holidayPatterns=$.grep(d.holidayPatterns,function(e){return e.isActive={id:e.isActive===!0?1:2,name:e.isActive===!0?"Active":"Inactive"},e.isActive}),d.gridOptions.data=d.holidayPatterns,d.patternsLoaded=!0},function(e){t.notify(e.message[0],{type:"danger"})})};(function(){l(),s()})()}])});