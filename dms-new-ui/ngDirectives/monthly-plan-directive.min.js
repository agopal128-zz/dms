"use strict";define(["angularAMD","dailyTargetController","metricType"],function(t){t.directive("monthlyPlan",["$uibModal","targetService",function(t,e){return{restrict:"E",scope:{monthlyTarget:"=",isEditable:"=",isPrimary:"=",mode:"=",isCascadeEnabled:"=",isCascaded:"=",isStretchGoalEnabled:"=",hasDifferentTargetEntry:"=",targetEntryMethod:"=",effectiveStartDate:"=",effectiveEndDate:"=",trackingMethod:"=",metricDataType:"=",submitDailyTarget:"&"},controller:["$scope",function(t){var e=this;e.isShowingTarget=!0,e.isDailyTargetAccessible=!1,e.isInDateRange=!1,e.isTargetEnteredDaily=!1;var a=function(){e.isDailyTargetAccessible=0===t.trackingMethod},r=function(){e.isTargetEnteredDaily=0===t.targetEntryMethod,angular.forEach(t.monthlyTarget,function(e){e.targetEntryMethod=t.targetEntryMethod})},n=function(){(t.isBowlingChartApplicable||t.isBowlingChartApplicable&&(t.metricDataType||0===t.metricDataType)&&2!==t.metricDataType)&&(t.isShowTotalColumn=!0),(!t.isBowlingChartApplicable||t.isBowlingChartApplicable&&t.metricDataType&&2===t.metricDataType)&&(t.isShowTotalColumn=!1)};n();var l=function(){t.effectiveStartDate&&t.monthlyTarget&&(t.effectiveStartMonth=$.grep(t.monthlyTarget,function(e){return e.month.year===t.effectiveStartDate.getFullYear()&&e.month.id==t.effectiveStartDate.getMonth()+1})[0],t.effectiveStartMonthIndex=t.monthlyTarget.indexOf(t.effectiveStartMonth)),t.effectiveEndDate&&t.monthlyTarget&&(t.effectiveEndMonth=$.grep(t.monthlyTarget,function(e){return e.month.year===t.effectiveEndDate.getFullYear()&&e.month.id==t.effectiveEndDate.getMonth()+1})[0],t.effectiveEndMonthIndex=t.monthlyTarget.indexOf(t.effectiveEndMonth)),angular.forEach(t.monthlyTarget,function(e,a){a>=t.effectiveStartMonthIndex&&a<=t.effectiveEndMonthIndex||(e.goalValue=e.stretchGoalValue=e.dailyRateValue="")})};l(),t.$watch("effectiveStartDate",function(){l()}),t.$watch("effectiveEndDate",function(){l()}),t.$watch("isCascadeEnabled",function(){e.isCascadeEnabled=t.isCascadeEnabled}),t.$watch("isCascaded",function(){e.isCascaded=t.isCascaded}),t.$watch("hasDifferentTargetEntry",function(){e.hasDifferentTargetEntry=t.hasDifferentTargetEntry}),t.$watch("monthlyTarget",function(){e.monthlyTarget=t.monthlyTarget,l()}),t.$watch("trackingMethod",function(){a()}),t.$watch("metricDataType",function(){n()}),t.$watch("targetEntryMethod",function(){r()}),t.$watch("metricDataType",function(){e.metricDataTypeName=0===t.metricDataType?"wholeNumber":"decimal"})}],controllerAs:"ctrl",templateUrl:"ngViews/targets/templates/monthlyPlan.tpl.min.html",link:function(t,e,a){t.showDailyTarget=function(e){t.submitDailyTarget({target:e,mode:t.mode,showDailyAndMonthly:self.hasDifferentTargetEntry,metricDataType:t.metricDataType})},t.calculateMaxAllowedTotal=function(e){var a=0;if(!t.metricDataType&&0!==t.metricDataType||2===t.metricDataType)a="";else{for(var r=0;r<t.monthlyTarget.length;r++)t.monthlyTarget[r].maximumAllowedGoal&&(a+=Math.round(100*parseFloat(t.monthlyTarget[r].maximumAllowedGoal))/100);a=Math.round(100*a)/100}return a},t.calculateRollupTotal=function(e){var a=0;if(!t.metricDataType&&0!==t.metricDataType||2===t.metricDataType)a="";else{for(var r=0;r<t.monthlyTarget.length;r++)t.monthlyTarget[r].rolledupGoalValue&&(a+=Math.round(100*parseFloat(t.monthlyTarget[r].rolledupGoalValue))/100);a=Math.round(100*a)/100}return a},t.clearDailyTargets=function(t){t.dailyTargets=[],t.isManualTarget=!0},t.calculateGoalTotal=function(e){var a=0,r=!1;if(!t.metricDataType&&0!==t.metricDataType||2===t.metricDataType)a="";else{for(var n=0;n<t.monthlyTarget.length;n++)t.monthlyTarget[n].goalValue&&(a+=Math.round(100*parseFloat(t.monthlyTarget[n].goalValue))/100),r=r||null!=t.monthlyTarget[n].goalValue;a=r?Math.round(100*a)/100:""}return a},t.calculateStretchGoalTotal=function(e){var a=0,r=0;if(!t.metricDataType&&0!==t.metricDataType||2===t.metricDataType)a="";else{for(var n=0;n<t.monthlyTarget.length;n++)t.monthlyTarget[n].stretchGoalValue&&(a+=Math.round(100*parseFloat(t.monthlyTarget[n].stretchGoalValue))/100),r=r||null!=t.monthlyTarget[n].stretchGoalValue;a=r?Math.round(100*a)/100:""}return a}}}}])});