"use strict";define(["angularAMD","angularRoute","bootstrap","uiBootstrap","uiBootstrapTpl","interceptor","configService","notificationService","notificationModalService","validationService","validationDirective","sessionStorageService","authService","appConfig","appMenu","appMenuDirective","appMenuConfig","appBehaviour","accordion","sglClick","ngTagsInput","toggleSwitch","enforceMaxTags","uiGrid","configurationService","confirmationModalService","utilityService","scorecardService","gridDropdown","datePickerDirective","filterUrlService","isDataLoaded","kendo.all.min","monthNavigationService"],function(e){var r=angular.module("novApp",["ngRoute","ui.bootstrap","ui.bootstrap.tpls","ngTagsInput","ui.grid","ui.grid.edit","ui.grid.validate","ui.grid.rowEdit","ui.grid.cellNav","kendo.directives"]);return r.controller("appController",["sessionStorageService","$window","$filter","$rootScope","$scope","$location","notificationModalService","notificationService","configurationService","authService","configService","confirmationModalService","utilityService","scorecardService","monthNavigationService",function(e,r,o,t,n,i,a,c,l,s,d,u,m,h,g){var p=this,f=d.getUIResources("User"),v=d.getUIResources("Scorecard"),y=d.getAppUrl();p.isUserAuthorised=s.isAuthorized(),m.loadExtentionMethods(),document.execCommand("ClearAuthenticationCache",!1);var S=function(){l.getCurrentDateAndYearId().then(function(e){var r=e.currentDate.slice(0,10);p.currentDate=o("date")(r,"fullDate"),p.monthId=parseInt(o("date")(r,"M"),10),p.yearId=e.yearId,p.day=o("date")(r,"dd")},function(e){e&&c.notify(e.errors.join("<br/>"),{autoClose:!1,type:"danger"})})},w=function(){h.getHierarchyDropdownList().then(function(e){p.dropDownOptions=h.hierarchyDropdownDto},function(e){c.notify(e.errors.join("<br/>"),{autoClose:!1,type:"danger"})})},D=(function(){l.getAll().then(function(r){e.set("configData",JSON.stringify(r)),S(),D(),p.isUserAuthorised&&w()},function(e){e&&c.notify(e.errors.join("<br/>"),{autoClose:!1,type:"danger"})})}(),function(){var o=JSON.parse(e.get("userData"));o&&o.roles||(o={},o.roles=["Anonymous"]),p.isIE=!!document.documentMode,p.isFullScreen=r.screen.width==r.innerWidth&&r.screen.height-r.innerHeight<=3,p.menuData=(new appMenu).get(o.roles),p.user=o&&o.user?o.user:"",p.fullName=o&&o.fullName||""===o.fullName?""!==o.fullName.trim()?o.fullName:o.user:"",t.title="NDMS Scorecard",t.kpiOwners=[],t.referrer=document.referrer,t.isScorecardDropdownVisible=!1,t.isRecordableVisible=!1,t.showAllScorecards=!1});p.login=function(){r.location.href=y+"Login/"},p.logout=function(){var o=u.openConfirmationModal("md",f.LogoutConfirmation);o.result.then(function(){var o=e.get("scorecardId");e.remove(AppConfig.AuthTokenKey),e.remove("userData"),e.remove("scorecardId"),o?r.location.href=y+"Scorecard/"+o:r.location.href=y+"Login/"})},p.close=function(){e.remove(AppConfig.AuthTokenKey),e.remove("userData"),e.remove("scorecardId"),r.close(),r.location.reload()},p.back=function(){r.history.back()},p.loadPrevMonthData=function(){if(!t.disableHeader){var e=g.setPreviousMonthDetails();if(t.displayMonth=g.getSelectedMonthDetails(),e&&n.$broadcast("monthChange"),!e){a.open({header:"",message:v.MonthNavigationMinError})}}},p.loadNextMonthData=function(){if(!t.disableHeader){var e=g.setNextMonthDetails();if(t.displayMonth=g.getSelectedMonthDetails(),e&&n.$broadcast("monthChange"),!e){a.open({header:"",message:v.MonthNavigationMaxError})}}},p.toggleHierarchy=function(e){n.$broadcast("hierarchyToggle",{showAllScorecards:e})},p.changeSelectedScorcard=function(e){n.$broadcast("selectedHierarchyOption",e)},angular.element(r).on("resize",function(){p.isIE=!!document.documentMode,p.isFullScreen=r.screen.width==r.innerWidth&&r.screen.height-r.innerHeight<=3})}]),r.config(["$routeProvider","$locationProvider",function(r,o){r.when("/Scorecard/:id?/:yearId?/:monthId?",e.route({templateUrl:"ngViews/dashboard/partials/scorecard-dashboard.min.html",controller:"scorecardDashboardController",controllerAs:"ctrl",menuKey:"dashboard"})).when("/Hierarchy/:default?",e.route({templateUrl:"ngViews/scorecard/partials/scorecard-hierarchy.min.html",controller:"ScorecardHierarchyController",controllerAs:"ctrl",menuKey:"hierarchy"})).when("/ScorecardAdmin/:mode/:id/:parentId?",e.route({templateUrl:"ngViews/scorecard/partials/add-edit-scorecard.min.html",controller:"ScorecardAdminController",controllerAs:"ctrl",menuKey:"scorecardadmin"})).when("/Admin/AddMetrics",e.route({templateUrl:"ngViews/metrics/partials/add-edit-metrics.min.html",controller:"MetricsController",controllerAs:"ctrl",menuKey:"addmetrics"})).when("/Admin/AssignMetrics",e.route({templateUrl:"ngViews/metrics/partials/assign-metrics.min.html",controller:"AssignMetricsController",controllerAs:"ctrl",menuKey:"assignmetrics"})).when("/Admin/HolidaySchedule",e.route({templateUrl:"ngViews/admin/partials/add-holiday-pattern.min.html",controller:"HolidayPatternController",controllerAs:"ctrl",menuKey:"addholidaypattern"})).when("/Admin/HolidaySchedule/:id",e.route({templateUrl:"ngViews/admin/partials/view-holiday-pattern.min.html",controller:"HolidaySelectorController",controllerAs:"ctrl",menuKey:"editholidays"})).when("/Admin/ListMaintenance",e.route({templateUrl:"ngViews/admin/partials/add-organizational-data.min.html",controller:"OrganizationalDataController",controllerAs:"ctrl",menuKey:"manageorganization"})).when("/Targets/Manage/:mode/:scorecardId/:parentId?",e.route({templateUrl:"ngViews/targets/partials/manage-target.min.html",controller:"ManageTargetController",controllerAs:"ctrl",menuKey:"target"})).when("/KPI/:kpiId/:scorecardId/:yearId/:monthId/:day",e.route({templateUrl:"ngViews/kpIs/partials/kpi.min.html",controller:"kpiController",controllerAs:"ctrl",menuKey:"kpi"})).when("/Drilldown/:scorecardId/:kpiId/:monthId/:yearId",e.route({templateUrl:"ngViews/kpIs/partials/drill-down.min.html",controller:"drillDownController",controllerAs:"ctrl",menuKey:"drilldown"})).when("/NotFound",{templateUrl:"404.html"}).otherwise({redirectTo:"/NotFound"}),o.html5Mode(!0)}]),r.run(["$location","$window","$rootScope","$injector","$interval","sessionStorageService","configService","$document","notificationModalService","$uibModalStack",function(e,r,o,t,n,i,a,c,l,s){function d(){g||location.reload(!0)}var u=Date.now(),m=JSON.parse(i.get("configData")),h=(m?60*m.sessionTimeout*1e3:18e5,i.get("scorecardId")),g=i.get(AppConfig.AuthTokenKey),p=m?60*m.autoRefreshDuration*1e3:3e5,f=angular.element(c);angular.forEach(["keydown","keyup","click","DOMMouseScroll","mousemove","mousewheel","mousedown","touchstart","touchmove","scroll","focus"],function(e){f.bind(e,function(){u=Date.now()})});var v=function(){var e=a.getAppUrl();h?r.location.href=e+"Scorecard/"+h:r.location.href=e+"Login/"},y=n(function(){var e=Date.now(),r=a.getUIResources("User"),o=JSON.parse(i.get("configData")),t=o?60*o.sessionTimeout*1e3:18e5;if(g&&e-u>=t){n.cancel(y),i.remove(AppConfig.AuthTokenKey),i.remove("userData");var c=l.open({header:"Timeout",message:r.sessionTimeout});c.result.then(function(){v()},function(){v()})}},3e4),d=n(d,p);o.$on("$routeChangeStart",function(e,r,o){if(u=Date.now(),"dashboard"!==r.menuKey&&"kpi"!==r.menuKey){var n=t.get("authService");n.isAuthorizedAndRedirect()&&$(".notify").remove()}var i=s.getTop();i&&(s.dismiss(i.key),e.preventDefault())}),o.$on("$routeChangeSuccess",function(e,r,t){"dashboard"===r.menuKey||"kpi"===r.menuKey?(o.isScorecardDropdownVisible=!0,o.isRecordableVisible=!0,o.isMonthNavigationVisible=!0,o.isHierarchyDropdownVisible=!1):(o.isScorecardDropdownVisible=!1,o.isRecordableVisible=!1,o.isHierarchyDropdownVisible="hierarchy"===r.menuKey,o.isMonthNavigationVisible="drilldown"===r.menuKey),$(".notify").remove()})}]),r.factory("ndmsServiceInterceptor",serviceInterceptor),r.config(["$httpProvider",function(e){e.interceptors.push("ndmsServiceInterceptor")}]),e.bootstrap(r)});