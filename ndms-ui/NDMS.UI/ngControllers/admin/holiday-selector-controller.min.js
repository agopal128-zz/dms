"use strict";define(["angularAMD","fullYearCalendar","holidayPatternService"],function(t){t.controller("HolidaySelectorController",["holidayPatternService","notificationService","confirmationModalService","configService","configurationService","utilityService","$routeParams","$rootScope","$filter","$window","$scope",function(t,e,a,n,o,i,r,c,d,l,s){var u=this,y=n.getUIResources("Holiday");u.holidayPatternId=r.id,u.holidayPattern={},u.isPatternChanged=!1,u.currentDate=i.convertToDateWithoutTimezone(new Date),u.calendarOptions={dayNamesLength:1},u.loadPreviousYear=function(){u.selectedYear--},u.loadNextYear=function(){u.selectedYear++},u.goBack=function(){if(u.isPatternChanged){var t=a.openConfirmationModal("md",y.NavigateConfirmation);t.result.then(function(){l.history.back()},function(){})}else l.history.back()},u.markOrUnmarkHoliday=function(t){var a=new Date(t.year,t.month,t.day);if(+a.getDatePart()<=+u.currentDate.getDatePart())e.notify(y.PastDateError,{autoclose:!1,type:"danger"});else{var n=P(a);n>-1?u.holidayPattern.holidaysList.splice(n,1):n===-1&&u.holidayPattern.holidaysList.push(a),u.lastChange=a,u.isPatternChanged=!0}},u.updateHolidays=function(){var t={holidayPatternId:parseInt(u.holidayPatternId),holidays:[]};u.holidayPattern.holidaysList.forEach(function(e){t.holidays.push(d("date")(e,"dd MMM yyyy"))}),h(t)};var h=function(a){t.setHolidayPatternInfo(a).then(function(t){e.notify(y.ListUpdatedSuccessfully,{type:"success"}).then(function(){u.isPatternChanged=!1})},function(t){e.notify(t.errors.join("<br>"),{autoclose:!1,type:"danger"}).then(function(){f()})})},f=function(){t.getHolidayPatternInfo(u.holidayPatternId).then(function(t){u.holidayPattern=t,u.holidayPattern.holidaysList=[],t.holidays.forEach(function(t){u.holidayPattern.holidaysList.push(i.convertToDateWithoutTimezone(t))}),u.currentDate=i.convertToDateWithoutTimezone(t.currentDate),u.calendarOptions.currentDate=u.currentDate,u.selectedYear=u.currentDate.getFullYear(),c.title="Holiday Schedule : "+u.holidayPattern.name},function(t){e.notify(t.errors.join("<br>"),{autoclose:!1,type:"danger"})})},P=function(t){var e=-1;return u.holidayPattern.holidaysList.forEach(function(a){+a.getDatePart()===+t.getDatePart()&&(e=u.holidayPattern.holidaysList.indexOf(a))}),e};(function(){f()})()}])});