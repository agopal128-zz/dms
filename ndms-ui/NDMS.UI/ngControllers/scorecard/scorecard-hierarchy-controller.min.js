"use strict";define(["angularAMD","scorecardService","d3js","hierarchyChartDirective","hierarchyChartHelper"],function(e){e.controller("ScorecardHierarchyController",["scorecardService","validationService","notificationService","configService","hierarchyChartDirective","$routeParams","$rootScope","$location","$scope",function(e,r,c,o,a,t,i,d,n){var l=this;l.hierarchyData=[],0===parseInt(t["default"])&&(i.lastActiveTopLevelScorecardId=null),l.selectedRootNodeId=i.lastActiveTopLevelScorecardId,l.selectedScorecardId=null,l.activeTopLevelScorecardId=null,i.title="Hierarchy",i.kpiOwners=[],i.scorecardId="",l.loadHierarchy=function(r){e.getScorecardHierarchyData(l.selectedRootNodeId,l.selectedScorecardId).then(function(e){l.hierarchyData=e,l.activeTopLevelScorecardId=l.hierarchyData.id;var c=s(l.hierarchyData);if(l.isRootNodeInactive=!c.isActive,r){var o=h(l.hierarchyData);i.title="Hierarchy : "+o.name}},function(e){e&&c.notify(e.errors.join("</br>"),{autoclose:!1,type:"danger"})})},n.$on("hierarchyToggle",function(e,r){l.showOnlyActiveScorecards=!r.showAllScorecards,toggleActiveRef&&toggleActiveRef(l.showOnlyActiveScorecards)}),n.$on("selectedHierarchyOption",function(e,r){r.topScorecardId==l.activeTopLevelScorecardId?(i.title="Hierarchy : "+r.scorecardName,setRootRef(r.id,r.parentScorecardId,l.showOnlyActiveScorecards)):(l.selectedRootNodeId=r.topScorecardId,l.selectedScorecardId=r.id,i.lastActiveTopLevelScorecardId=l.selectedRootNodeId,i.title="Hierarchy : "+r.scorecardName,l.loadHierarchy())});var h=function(e){if(e.expandTillDrilldownLevel)return e;if(e.children)for(var r in e.children){var c=e.children[r];c._parent=e,c.parent=null;var o=h(c);if(o)return o}return null},s=function(e){if(e.isRootNode)return e;if(e.children)for(var r in e.children){var c=e.children[r];c._parent=e,c.parent=null;var o=s(c);if(o)return o}return null};(function(){l.showOnlyActiveScorecards=!0,l.isRootNodeInactive=!1,l.loadHierarchy(!0)})()}])});